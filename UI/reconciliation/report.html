<?lsmb PROCESS 'ui-header.html' ?>
<?lsmb PROCESS 'elements.html' ?>

<form action="recon.pl" method="post">
<div class="listtop" id="title"><?lsmb text('Reconciliation Report') ?></div>
<div class="info">
<div> <?lsmb text('Account:') ?><?lsmb account ?></div>
<div><?lsmb text('Through date:') ?><?lsmb end_date ?></div>
<div><?lsmb text('Statement Balance:') ?><?lsmb INCLUDE input element_data = {
	name = "their_total",
	type = "text",
	class = "money",
	size = "15",
	value = their_total
	} ?>
</div>
<div><?lsmb text('Beginning Balance:') ?><?lsmb beginning_balance ?></div>
<div><?lsmb text('Ledger Balance:') ?><?lsmb our_total ?></div>
<div><?lsmb text('Difference:') ?><?lsmb out_of_balance ?></div>
	<div id="csv-file">
        <label for="file_upload"><?lsmb text('CSV File:') ?></label>
        <input type="file" name="csv_file" id="file_upload" /></div>

<center>Report generated by <?lsmb user ?></center>

<?lsmb IF error ?>
<div style="border-color:red; border-width:1px; border-style:solid; margin:3px;" >
	<?lsmb error ?>	
</div>
<?lsmb END ?>
<?lsmb i = 1 ?>
<table border=0>
	<tr class="listtop">
		<th colspan=7><?lsmb text('Cleared Transactions') ?></th>
	</tr>
	<tr class="listheading">
		<th><?lsmb text('Cleared') ?></th>
		<th><?lsmb text('Transaction Type') ?></th>
		<th><?lsmb text('Clear date') ?></th>
		<th><?lsmb text('Source') ?></th>
		<th><?lsmb text('Posted Date') ?></th>
		<th><?lsmb text('Our Balance') ?></th>
		<th><?lsmb text('Their Balance') ?></th>
		<th></th>
	</tr>
	
	<?lsmb FOREACH row = report_lines ?>
			<?lsmb IF (row.our_balance == row.their_balance) or
				row.cleared or ${"cleared_$row.id"}
				-?>
				<?lsmb row.cleared = 'checked' ?>
				<?lsmb ELSE ?> <?lsmb row.cleared = undef -?> 
				<?lsmb END -?>
	<?lsmb IF row.cleared == 'checked' ?>
	<?lsmb INCLUDE input element_data = {
		type = "hidden",
		name = "id_$i",
		value = row.id
	} ?>
		<?lsmb IF row.errorcode != 0 ?>
		<tr style="background-color:pink;">
		<?lsmb ELSIF row.id == corrected ?>
		<tr style="background-color:yellow;">		
		<?lsmb ELSE ?>
		<tr>
		<?lsmb END ?>
			<td><?lsmb INCLUDE input element_data = {
			type = "checkbox"
			name = "cleared_$row.id"
			value = row.id
			checked = row.cleared
			}
			?></td>
			<td><?lsmb row.transaction_type ?> </td>
			<td><?lsmb row.clear_time ?></td>
			<td><?lsmb row.scn ?> </td>
			<td><?lsmb row.post_date ?></td>
			<td><?lsmb row.our_balance ?></td>
			<td><?lsmb row.their_balance ?></td>
		</tr>
	<?lsmb i = i + 1 -?>
	<?lsmb END ?>
	<?lsmb END -?>
	<tr class="subtital">
		<th colspan=5><?lsmb text('Total') ?></th><td><?lsmb cleared_total ?></td>
	</tr>
	<tr class="listheading">
		<th colspan=7><?lsmb text('Outstanding Transactions') ?></th>
	</tr>
	<tr class="listheading">
		<th><?lsmb text('Cleared') ?></th>
		<th><?lsmb text('Transaction Type') ?></th>
		<th><?lsmb text('Clear date') ?></th>
		<th><?lsmb text('Source') ?></th>
		<th><?lsmb text('Posted Date') ?></th>
		<th><?lsmb text('Our Balance') ?></th>
		<th><?lsmb text('Their Balance') ?></th>
		<th></th>
	</tr>
	<?lsmb FOREACH row = report_lines ?>
	<?lsmb IF row.cleared != 'checked' ?>
	<?lsmb INCLUDE input element_data = {
		type = "hidden",
		name = "id_$i",
		value = row.id
	} ?>
		<?lsmb IF row.errorcode != 0 ?>
		<tr style="background-color:pink;">
		<?lsmb ELSIF row.id == corrected ?>
		<tr style="background-color:yellow;">		
		<?lsmb ELSE ?>
		<tr>
		<?lsmb END ?>
			<td><?lsmb INCLUDE input element_data = {
			type = "checkbox"
			name = "cleared_$row.id"
			value = row.id
			checked = row.cleared
			}
			?></td>
			<td><?lsmb row.transaction_type ?> </td>
			<td><?lsmb row.clear_time ?></td>
			<td><?lsmb row.scn ?> </td>
			<td><?lsmb row.post_date ?></td>
			<td><?lsmb row.our_balance ?></td>
			<td><?lsmb row.their_balance ?></td>
		</tr>
	<?lsmb i = i + 1 -?>
	<?lsmb END ?>
	<?lsmb END -?>
	<tr class="subtital">
		<th colspan=5><?lsmb text('Total') ?></th><td><?lsmb outstanding_total ?></td>
	</tr>
</table>
<?lsmb INCLUDE input element_data = {
	name = "report_id",
	type = "hidden",
	value = report_id,
} ?><?lsmb IF NOT submitted ?>
<?lsmb INCLUDE select element_data = {
	name = "line_order",
	label = text('Order By'), #'
	options = sort_options,
	text_attr = 'label',
	value_attr = 'id',
	default_values = [line_order]
	class = 'sort'
} ?>
<?lsmb INCLUDE button element_data = {
	name = "action",
	text = text('Update'),
	value = 'update_recon_set',
	class = "submit"
} ?>
<?lsmb INCLUDE button element_data = {
	name = "action",
	text = text('Submit'),
	value = 'submit_recon_set',
	class = "submit"
} ?>
<?lsmb END ?>
<?lsmb IF submitted AND NOT approved AND can_approve ?>
<?lsmb INCLUDE button element_data = {
	name = "action",
	text = text('Approve'),
	value = 'Approve',
	class = "submit"
} ?>
<?lsmb END ?>

</body></html>
