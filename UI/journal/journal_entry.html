[% PROCESS elements.html %]

<body class="lsmb [% dojo_theme %]">

[% CLASS = 'new';
   IF form.id and form.approved;
       CLASS = 'posted';
   ELSIF id;
       CLASS = 'saved';
   END;
%]<div id="statusdiv" class="[% CLASS %]">
    <div id="history">[% text('Action: [_1], ID: [_2]', form.action, form.id);
      %]</div>


<form data-dojo-type="lsmb/Form" method="post" action="[% form.script %]">
<table width="100%">
<tr>
    <th class="listtop" >[% form.title %]</th>
</tr>

<tr>
    <td>
      <table>
        <tr>
          <th align="right">[% text('Reference') %]</th>
          <td>
               [% INCLUDE input element_data = {
                        name = "reference",
                        value = form.reference,
                        type = "text",
                        size = "20",
                        class = 'reference'
                        id = "ref_1"
                };
             IF form.sequences;
                 form.sequences.unshift({});
                 PROCESS select element_data = {
                    name = 'setting_sequence'
          default_values = [form.setting_sequence]
                 options = form.sequences
               text_attr = 'label'
              value_attr = 'label'
                 };
             END; %]
         </td>
          <th align="right">[% text('Date') %]</th>
          <td>
              [% INCLUDE input element_data = {
                        name = "transdate"
         id = "transdate"
                        value = form.transdate
                        size = "11"
                        type = 'text'
                        class = 'date'
              } %]
          </td>
        </tr>
        <tr>
          <th align="right">[% text('Description') %]</th>
          <td colspan="3">
                        [% IF form.colrowdesc ==1 %]
                              [% INCLUDE textarea element_data={
                                                        name = "description"
                                                        rows = form.rowsdesc
                                                        cols = form.colsdesc
                                                        text = form.description
                                                        id = "des_1"
                                                                    }
                               %]
                        [% ELSE %]
                                  [% INCLUDE textarea element_data = {
                                                      name = "description",
                                                      text = form.description,
                                                      type = "text",
                                                      size = "50",
                                                      class = 'description'
                                                      id = "des_1"
                                                                      }
                                   %]

                        [% END %]
          </td>
        </tr>
        <tr>
          <th align="right">[% text('Notes') %]</th>
          <td colspan="3">
                        [% IF form.colrownotes ==1 %]
                              [% INCLUDE textarea element_data={
                                                        name = "notes"
                                                        rows = form.rowsnotes
                                                        cols = form.colsnotes
                                                        text = form.notes
                                                        id = "not_1"
                                                            }
                               %]
                        [% ELSE %]
                                  [% INCLUDE textarea element_data = {
                                                      name = "notes",
                                                      value = form.notes,
                                                      size = "50",
                                                      class = 'notes'
                                                      id = "not_1"
                                                          }
                                   %]

                        [% END %]


          </td>
        </tr>
        <tr>
          <th align="right">[% text('FX') %]</th>
          <td colspan="3">
            [% PROCESS input element_data = {
                   name="fx_transaction"
                   type='checkbox'
                   class='fx_checkbox'
                   "data-dojo-type"="lsmb/journal/fx_checkbox"
                   value=1
                   checked=form.fx_transaction } %]
          </td>
        </tr>
      </table>
    </td>
 </tr>

<tr>
    <td>
      <table width="100%" id="transaction-table"
             [% IF form.fx_transaction ;
                    'class="fx-transaction"' ;
                    ELSE ;
                    'class="no-fx-transaction"' ;
                    END -%]
             >
          <tr class="listheading">
          <th class="listheading">[% text('Account') %]</th>
          <th class="listheading">[% text('FX') %]</th>
          <th class="listheading">[% text('Debit') %]</th>
          <th class="listheading">[% text('Credit') %]</th>
          <th class="listheading">[% text('Source') %]</th>
          <th class="listheading">[% text('Memo') %]</th>
          [% IF form.projectset == 1 %]
          <th class="listheading">[% text('Project') %]</th>
          [% END %]
          [% FOREACH cls IN form.bu_class %]
              [% IF form.b_units.${cls.id} %]
          <th>[% text(cls.label) %]</th>
               [% END %]
          [% END %]
        </tr>
          [%
        curr = [];
        FOREACH c IN form.currencies;
           curr.push({ text = c, value = c });
        END;
        FOREACH displayrow IN displayrows %]
        <tr>
                [% INDEX=displayrow.index %]
                  <td>
                        [% IF displayrow.accnoset == 0 %]
                                [% PROCESS input element_data = {
                                      name = "accno_$INDEX"
                                                                         type = "text"
                                      initial_value = ${"accno_$INDEX"}
                                      value = ${"accno_$INDEX"}
                                      text_attr = 'accno'
                                      value_attr = 'id'
                                                                         class = 'AccountBox'
                                                                         'data-dojo-type' = 'lsmb/accounts/AccountSelector'
                            'data-dojo-props' = 'required: false'
                              } %]

                          [% ELSE %]

                                      [% PROCESS label element_data = {
                                        text = displayrow.accno
                                        align = 'right'
                                        id = "acc_$INDEX"
                                      } %]


                        [% END %]

                 </td>

                      <td>
                        [% form.currencies.0 %]
                      </td>


                  <td>
                          [% PROCESS input element_data = {
                                  value = displayrow.debit
                                  name = "debit_$INDEX"
                                  type = "currency"
                                  size = 12
                                  accesskey = displayrow.index
                                  id = "deb_$INDEX"
                                              }  %]

                   </td>

                  <td>
                          [% PROCESS input element_data = {
                                  value = displayrow.credit
                                  name = "credit_$INDEX"
                                  type = "currency"
                                  size = 12
                                  id = "cre_$INDEX"
                                      }  %]

                   </td>

                    <td>
                          [% PROCESS input element_data = {
                                  value = displayrow.source
                                  name = "source_$INDEX"
                                  type = "text"
                                  size = 10
                                  id = "sou_$INDEX"

                           }  %]

                   </td>

                    <td>
                          [% PROCESS textarea element_data = {
                                  value = displayrow.memo
                                  name = "memo_$INDEX"
                                  size = 30
                                  id = "mem_$INDEX"
                                     }  %]

                   </td>
                  [% IF form.projectset == 1 %]
                   <td>

                        [% IF displayrow.projectset == 1 %]
                                        [% PROCESS label element_data = {
                                              text = displayrow.projectnumber
                                              align = 'right'
                                              id = "pro_$INDEX"
                                     } %]


                        [% ELSE %]
                                [% INCLUDE select element_data = {
                                        text_attr = "projectnumber"
                                        value_attr = "projectstyle"
                                        default_values = []
                                        options = form.all_project
                                        name = "projectnumber_$INDEX"
                                        id = "pro_$INDEX"
                                     } %]

                        [% END %]

                   </td>
                       [% END %]
                   [% FOREACH cls IN form.bu_class %]
                      [% IF form.b_units.${cls.id} %]
                   <td>

                       [% clsid = cls.id;
                              bucid = "b_unit_$clsid";
                              burow = "${bucid}_$INDEX";
                       form.b_units.${clsid}.unshift({});
                       INCLUDE select element_data = {
                              text_attr = "control_code"
                             value_attr = "id"
                         default_values = [displayrow.${bucid}]
                                   name = "$burow"
                                options = form.b_units.${clsid}
                       } %]
                   </td>
                   [% END %]
                  [% END %]

        </tr>
     <tr class="fx-row">
       <td><!-- account cell is empty --></td>
       <td>[% PROCESS select element_data = {
                  options = curr
                  name = "curr_$INDEX"
                  default_values = [displayrow.curr]
                  } %]</td>

       <td>
         [% PROCESS input element_data = {
                        value = displayrow.debit_fx
                        name = "debit_fx_$INDEX"
                        type = "currency"
                                  size = 12
                                  accesskey = displayrow.index
                                  id = "deb_fx_$INDEX"
                                              }  %]
       </td>

       <td>
         [% PROCESS input element_data = {
                                  value = displayrow.credit_fx
                                  name = "credit_fx_$INDEX"
                                  type = "currency"
                                  size = 12
                                  id = "cre_fx_$INDEX"
                                      }  %]
       </td>
     </tr>
     [% END %]
        <tr class="listtotal">
          <th>&nbsp;</th>
             <th>&nbsp;</th>
          <th class="listtotal debitsubtotal" align="right">
                        [% form.totaldebit %]
          </th>

          <th class="listtotal creditsubtotal" align="right">
                        [% form.totalcredit %]
          </th>
          <th>&nbsp;</th>
          <th>&nbsp;</th>
          [% IF form.projectset == 1 %]
          <th class="listheading">&nbsp;</th>
          [% END %]
          [% FOREACH cls IN form.bu_class %]
              [% IF form.b_units.${cls.id} %]
          <th>&nbsp;</th>
               [% END %]
          [% END %]
        </tr>

     </table>
    </td>
</tr>
 <tr>
    <td><hr size="3" /></td>
  </tr>
</table>
[% FOREACH hidden IN hiddens.keys;
        PROCESS input element_data={
                type => 'hidden',
                name => hidden,
                value => hiddens.item(hidden)
                }; END %]

[% FOREACH button IN buttons; PROCESS button element_data=button; END %]
[% IF form.recurringset ==1 %]
          [% PROCESS label element_data = {
                text => text('Scheduled')
                align => 'right'
           } %]

[% END %]
[% IF form.id %]
<table width="100%">
<tr class="listtop">
<th colspan="4">[% text('Attached and Linked Files') %]</th>
</tr>
<tr class="listheading">
<th>[% text('File name') %]</th>
<th>[% text('File type') %]</th>
<th>[% text('Attached at') %]</th>
<th>[% text('Attached by') %]</th>
</tr>
[% FOREACH file IN form.files %]
<tr>
<td><a href="file.pl?action=get&amp;file_class=1&amp;ref_key=[% form.id
            %]&amp;id=[% file.id %]" target="_download"
            >[% file.file_name %]</a></td>
<td>[% file.mime_type %]</td>
<td>[% file.uploaded_at %]</td>
<td>[% file.uploaded_by_name %]</td>
</tr>
[% END %]
</table>
<table width="100%">
<tr class="listheading">
<th>[% text('File name') %]</th>
<th>[% text('File type') %]</th>
<th>[% text('Attached To Type') %]</th>
<th>[% text('Attached To') %]</th>
<th>[% text('Attached at') %]</th>
<th>[% text('Attached by') %]</th>
</tr>
[%
FOREACH link IN form.file_links;
        aclass="&nbsp;";
        IF link.src_class() == 1;
            aclass="Transaction";
        ELSIF link.src_class() == 2;
            aclass="Order";
        END; %]
<tr>
<td>[% file.file_name %]</td>
<td>[% file.mime_type %]</td>
<td>[% aclass %]</td>
<td>[% file.reference() %]</td>
<td>[% file.attached_at() %]</td>
<td>[% file.attached_by() %]</td>
</tr>
[% END # FOREACH %]
</table>
[% callback = "gl.pl?action=edit&amp;id=" _ form.id -%]
<a href="file.pl?action=show_attachment_screen&amp;ref_key=[% form.id
   %]&amp;file_class=1&amp;callback=[% callback | uri %]">[[% text('Attach') %]]</a>
[% END # IF for[% INCLUDE CLOSE_STATUS_DIV id=form.id approved = form.approved %]
</form>
</div>
</body>
