<?lsmb INCLUDE 'ui-header.html';
       PROCESS 'elements.html';
       PROCESS 'report_base.html';
       PROCESS 'utilities.html';
?>
<body class="lsmb <?lsmb dojo_theme ?>">
<form data-dojo-type="lsmb/Timecard" action="timecard.pl" method="post"
      data-dojo-props="topic:'/timecard/'"
>
<?lsmb FOR hidden IN ['id', 'parts_id', 'in_edit', 'defaultcurr',
                      'bu_class_id', 'partnumber'];
PROCESS input element_data = {
    type = 'hidden'
   class = 'hidden'
    name = "$hidden"
   value = request.$hidden
};
END; ?>
<div class="listtop"><?lsmb text('Time or Materials Card') ?></div>
<table id="tableTimecard"><tbody>
<tr><th colspan="2" class="listtop"><?lsmb text('Category') ?> :
    </th>
</tr>
<tr>
    <td colspan=2 class="input_row" id="timecard_type_radios">
    <?lsmb
        PROCESS input element_data={
           value  = 'by_time'
              id  = 'timecard_by_time'
            name  = 'timecard_type',
           label  = text('Time')
            type  = "radio"
         checked  = request.jctype == 1 ? "checked" : undef
"data-dojo-type"  = "lsmb/PublishRadioButton"
"data-dojo-props" = "topic:'/timecard/type'"
        };
        PROCESS input element_data={
           value  = 'by_materials'
              id  = 'timecard_by_materials'
            name  = 'timecard_type',
           label  = text('Materials')
            type  = "radio"
         checked  = request.jctype == 2 ? "checked" : undef
"data-dojo-type"  = "lsmb/PublishRadioButton"
"data-dojo-props" = "topic:'/timecard/type'"
        };
        PROCESS input element_data={
           value  = 'by_overhead'
              id  = 'timecard_by_overhead'
            name  = 'timecard_type',
           label  = text('Overhead')
            type  = "radio"
         checked  = request.jctype == 3 ? "checked" : undef
"data-dojo-type"  = "lsmb/PublishRadioButton"
"data-dojo-props" = "topic:'/timecard/type'"
        };
        ?>
    </td>
</tr>
<tr id="business_unit">
  <th><?lsmb text('Entered For') ?></th>
  <td><?lsmb
        FOREACH bu IN request.b_units;
            bu.text = bu.control_code _ ' -- ' _ bu.description;
        END;
        PROCESS select element_data = {
                       name = "business_unit_id"
             default_values = [request.business_unit_id]
                    options = request.b_units
                  text_attr = 'text'
                 value_attr = 'id'
                   required = 1
           "data-dojo-type" = "lsmb/PublishSelect"
          "data-dojo-props" = "topic:'/timecard/unit'"
       } ?></td>
</tr>
<tr><th><?lsmb text('Partnumber') ?></th>
  <td>
    <input data-dojo-type="lsmb/parts/PartSelector"
           data-dojo-props="required:false,channel:'/timecard/part-select/day',fetchProperties:{type:'sales'}"
           name="partnumber"
           id="partnumber"
           size="32"
           value="<?lsmb request.partnumber ?>"
           accesskey="p"
           required="required"
           title="[p]"
           class="control-code" />
    </td>
</tr>
<tr><th><?lsmb text('Description') ?></th>
  <td colspan="3">
    <div data-dojo-type="lsmb/parts/PartDescription"
         data-dojo-props="channel:'/timecard/part-select/day'"
         name="description"
         id="description"
         style="width:100%"
         class="description"><?lsmb request.description ?></div>
    </td>
</tr>
<tr><th><?lsmb text('Date Worked') ?></th>
    <td><?lsmb PROCESS input element_data = {
                 id = 'transdate'
               name = 'transdate'
              value = request.transdate
               type = 'date',
               size = '15',
              class = 'date'
  "data-dojo-props" = "topic:'/timecard/date'"
        } ?>
     </td>
</tr>
<?lsmb IF request.jctype == 1 OR request.jctype == 3 ?>
    <tr id='in-time'>
        <th><?lsmb text('Time In') ?></th>
        <td><?lsmb PROCESS input element_data = {
         "data-dojo-type" = "lsmb/PublishNumberTextBox"
        "data-dojo-props" = "topic:'/timecard/clocked',constraints:{min:0,max:23,places:0}"
                     name = 'in_hour'
                       id = 'in-hour'
                    value = request.in_hour
                     type = 'text'
                    class = 'time-part'
                     size = 3
                maxlength = 2 } ?> :
            <?lsmb PROCESS input element_data = {
         "data-dojo-type" = "lsmb/PublishNumberTextBox"
        "data-dojo-props" = "topic:'/timecard/clocked',constraints:{min:0,max:59,places:0}"
                     name = 'in_min'
                       id = 'in-min'
                    value = request.in_min
                     type = 'text'
                    class = 'time-part'
                     size = 3
              maxlength = 2 } ?>
         </td>
        <th><?lsmb text('Time Out') ?></th>
        <td><?lsmb PROCESS input element_data = {
         "data-dojo-type" = "lsmb/PublishNumberTextBox"
        "data-dojo-props" = "topic:'/timecard/clocked',constraints:{min:0,max:23,places:0}"
                     name = 'out_hour'
                       id = 'out-hour'
                    value = request.out_hour
                     type = 'text'
                    class = 'time-part'
                     size = 3
                maxlength = 2 } ?> :
            <?lsmb PROCESS input element_data = {
         "data-dojo-type" = "lsmb/PublishNumberTextBox"
        "data-dojo-props" = "topic:'/timecard/clocked',constraints:{min:0,max:59,places:0}"
                     name = 'out_min'
                       id = 'out-min'
                    value = request.out_min
                     type = 'text'
                    class = 'time-part'
                     size = 3
                maxlength = 2 } ?>
         </td>
    </tr>
    <tr><th><?lsmb text('Clocked') ?></th>
        <td><?lsmb PROCESS input element_data = {
     "data-dojo-type" = "dijit/form/NumberTextBox"
           name = 'total'
       readonly = 'true'
          class = 'readonly'
          value = request.total
           type = 'text'
           size = 16 } ?></td>
    </tr>
<?lsmb END # if is_service or is_timecard ?>
<tr><th><?lsmb text('Chargeable') ?></th>
    <td><?lsmb PROCESS input element_data = {
 "data-dojo-type" = "lsmb/PublishNumberTextBox"
"data-dojo-props" = "topic:'/timecard/qty',constraints:{min:0}"
               id = 'qty'
             name = 'qty'
            value = request.qty
             type = 'text'
            class = 'qty'
             size = 16 } ?></td>
</td>
<tr><th><?lsmb text('Non-Chargeable') ?></th>
    <td><?lsmb PROCESS input element_data = {
 "data-dojo-type" = "dijit/form/NumberTextBox"
"data-dojo-props" = "constraints:{min:0}"
       name = 'non_billable'
      value = request.non_billable
       type = 'text'
      class = 'qty'
       size = 16 } ?></td>
</tr>
<tr><th><?lsmb text('Currency') ?></th>
    <td><?lsmb
       INCLUDE select element_data = {
                id = 'curr'
              name = 'curr'
           options = request.currencies
    default_values = [request.curr]
  "data-dojo-type" = "lsmb/PublishSelect"
 "data-dojo-props" = "topic:'/timecard/curr'"
       }; ?></td>
</tr>
<tr><th><?lsmb text('Unit price') ?></th>
    <td><?lsmb PROCESS input element_data = {
         id = 'unitprice'
       name = 'unitprice'
      value = request.unitprice
       type = 'currency'
      class = 'qty'
  "data-dojo-type" = "lsmb/parts/PartSellprice"
 "data-dojo-props" = "channel:'/timecard/part-select/day',constraints:{fractional:true,min:0}"
       size = 16 } ?></td>
</tr>
<tr><th><?lsmb text('FX rate') ?></th>
    <td><?lsmb PROCESS input element_data = {
       name = 'fxrate'
      value = request.fxrate
       type = 'text'
      class = 'qty'
   disabled = request.curr == request.defaultcurr
  "data-dojo-type" = "lsmb/PublishNumberTextBox"
 "data-dojo-props" = "topic:'/timecard/fxrate',constraints:{fractional:true,min:0}"
       size = 16 } ?></td>
</td>
<tr><th><?lsmb text('Sell Price') ?></th>
    <td><?lsmb PROCESS input element_data = {
 "data-dojo-type" = "dijit/form/CurrencyTextBox"
       name = 'sellprice'
   disabled = "disabled"
      class = 'qty readonly'
      value = request.sellprice
       type = 'text'
       size = 16 } ?></td>
</tr>
<tr><th><?lsmb text('FX Sell Price') ?></th>
    <td><?lsmb PROCESS input element_data = {
 "data-dojo-type" = "dijit/form/CurrencyTextBox"
       name = 'fxsellprice'
   readonly = 'readonly'
      class = 'qty'
      value = request.fxsellprice
       type = 'text'
       size = 16 } ?></td>
</tr>
<tr><th><?lsmb text('Allocated') ?></th>
    <td><?lsmb PROCESS input element_data = {
 "data-dojo-type" = "dijit/form/NumberTextBox"
       name = 'allocated'
   readonly = 'true'
      class = 'qty readonly'
      value = request.allocated
       type = 'text'
       size = 16 } ?></td>
</tr>
<tr><th align><?lsmb text('Notes') ?></th>
    <td colspan=3>
        <?lsmb PROCESS textarea element_data = {
                     name = "notes"
                     rows = 2
                     cols = 46
                     wrap = "soft"
                     text = request.notes } ?>
    </td>
</tr>
</tbody></table>
<?lsmb IF request.id;
    PROCESS print_options;
END;
IF request.id && !request.in_edit;
    PROCESS button element_data = {
       name = 'action'
       type = 'submit'
      class = 'submit'
       text = text('New')
       value = 'new'
    };
    PROCESS button element_data = {
       name = 'action'
       type = 'submit'
      class = 'submit'
       text = text('Edit')
       value = 'edit'
    };
ELSE;
   PROCESS button element_data = {
         id = 'action_save'
       name = 'action'
       type = 'submit'
      class = 'submit'
       text = text('Save')
      value = 'save'
   disabled =  request.jctype < 1 OR request.jctype > 3
   }; ?>
<?lsmb
END;
IF request.id;
    PROCESS button element_data = {
       name = 'action'
      class = 'submit'
       text = text('Print')
       value = 'print'
       "data-dojo-type" = "lsmb/PrintButton"
   };
END;
IF request.id && (!request.allocated || request.qty > request.allocated);
    PROCESS button element_data = {
       name = 'action'
       type = 'submit'
      class = 'submit'
       text = text('Delete')
       value = 'delete'
       type = 'submit'
    };
END;
?>
</form>
</body>
</html>
