<?lsmb INCLUDE 'ui-header.html';
       PROCESS 'elements.html';
       PROCESS 'report_base.html';
       PROCESS 'utilities.html';
?>
<body class="lsmb <?lsmb dojo_theme ?>">
<form data-dojo-type="lsmb/Timecard" action="timecard.pl" method="post"
      data-dojo-props="topic:'/timecard/'"
>
<?lsmb FOR hidden IN ['id', 'parts_id', 'in_edit', 'defaultcurr'];
PROCESS input element_data = {
    type = 'hidden'
    name = hidden
   value = $hidden
};
END; ?>
<div class="listtop"><?lsmb text('Time or Materials Card') ?></div>
<table id="tableTimecard"><tbody>
<tr><th colspan="2" class="listtop"><?lsmb text('Category') ?> : 
    </th>
</tr>
<tr>
    <td colspan=2 class="input_row" id="timecard_type_radios">
    <?lsmb
        PROCESS input element_data={
           value  = 'by_time' 
              id  = 'timecard_by_time' 
            name  = 'timecard_type',
           label  = text('Time') 
            type  = "radio"
         checked  = jctype == 1 ? "checked" : undef
"data-dojo-type"  = "lsmb/PublishRadioButton"
"data-dojo-props" = "topic:'/timecard/type'"
        };
        PROCESS input element_data={
           value  = 'by_materials' 
              id  = 'timecard_by_materials' 
            name  = 'timecard_type',
           label  = text('Materials') 
            type  = "radio"
         checked  = jctype == 2 ? "checked" : undef
"data-dojo-type"  = "lsmb/PublishRadioButton"
"data-dojo-props" = "topic:'/timecard/type'"
        };
        PROCESS input element_data={
           value  = 'by_overhead' 
              id  = 'timecard_by_overhead' 
            name  = 'timecard_type',
           label  = text('Overhead') 
            type  = "radio"
         checked  = jctype == 3 ? "checked" : undef
"data-dojo-type"  = "lsmb/PublishRadioButton"
"data-dojo-props" = "topic:'/timecard/type'"
        };
        ?>
    </td>
</tr>
<tr id="business_unit">
  <th><?lsmb text('Entered For') ?></th>
  <td><?lsmb
        FOREACH bu IN b_units;
            bu.text = bu.control_code _ ' -- ' _ bu.description;
        END;
        PROCESS select element_data = {
                       name = "business_unit_id"
             default_values = [business_unit_id]
                    options = b_units
                  text_attr = 'text'
                 value_attr = 'id'
           "data-dojo-type" = "lsmb/PublishSelect"
          "data-dojo-props" = "topic:'/timecard/part'"
       } ?></td>
<tr><th><?lsmb  text('Partnumber') ?></th>
  <td>
    <input data-dojo-type="lsmb/parts/PartSelector"
           data-dojo-props="required:false,channel:'/timecard/part-select/day',fetchProperties:{type:'sales'}"
           name="partnumber"
           id="partnumber"
           size="32"
           value="<?lsmb partnumber ?>"
           accesskey="p"
           title="[p]"
           class="control-code" />
    </td>
</tr>
<tr><th><?lsmb text('Description') ?></th>
  <td>
    <div data-dojo-type="lsmb/parts/PartDescription"
         data-dojo-props="channel:'/timecard/part-select/day'"
         name="description"
         id="description"
         style="width:100%"
         class="description"><?lsmb description ?></div>
    </td>
</tr>
<tr><th><?lsmb text('Date Worked') ?></th>
    <td><?lsmb PROCESS input element_data = {
                 id = 'transdate'
               name = 'transdate'
              value = transdate
               type = 'text',
               size = '15',
              class = 'date'
  "data-dojo-props" = "topic:'/timecard/'"
        } ?>
     </td>
</tr>
<?lsmb IF jctype == 1 OR jctype == 3 ?>
<tr id='in-time'>
<th><?lsmb text('Time In') ?></th>
<td><?lsmb PROCESS input element_data = {
 "data-dojo-type" = "lsmb/PublishNumberTextBox"
"data-dojo-props" = "topic:'/timecard/clocked'"
             name = 'in_hour'
               id = 'in-hour'
            value = in_hour
             type = 'text'
            class = 'time-part'
             size = 3
        maxlength = 2 } ?> : 
    <?lsmb PROCESS input element_data = {
 "data-dojo-type" = "lsmb/PublishNumberTextBox"
"data-dojo-props" = "topic:'/timecard/clocked'"
             name = 'in_min'
               id = 'in-min'
            value = in_min
             type = 'text'
            class = 'time-part'
             size = 3
      maxlength = 2 } ?>
 </td> 
<th><?lsmb text('Time Out') ?></th>
<td><?lsmb PROCESS input element_data = {
 "data-dojo-type" = "lsmb/PublishNumberTextBox"
"data-dojo-props" = "topic:'/timecard/clocked'"
             name = 'out_hour'
               id = 'out-hour'
            value = out_hour
             type = 'text'
            class = 'time-part'
             size = 3
        maxlength = 2 } ?> : 
    <?lsmb PROCESS input element_data = {
 "data-dojo-type" = "lsmb/PublishNumberTextBox"
"data-dojo-props" = "topic:'/timecard/clocked'"
             name = 'out_min'
               id = 'out-min'
            value = out_min
             type = 'text'
            class = 'time-part'
             size = 3
        maxlength = 2 } ?>
 </td> 
</tr>
<tr><th><?lsmb text('Clocked') ?></th>
    <td id=total><?lsmb total ?></td>
</tr>
<?lsmb END # if is_service or is_timecard ?>
<tr><th><?lsmb text('Chargeable') ?></th>
    <td><?lsmb PROCESS input element_data = {
 "data-dojo-type" = "lsmb/PublishNumberTextBox"
"data-dojo-props" = "topic:'/timecard/qty'"
               id = 'qty'
             name = 'qty'
            value = qty
             type = 'text'
            class = 'qty'
             size = 16 } ?></td>
</td>
<tr><th><?lsmb text('Non-Chargeable') ?></th>
    <td><?lsmb PROCESS input element_data = {
       name = 'non_billable'
      value = non_billable
       type = 'text'
      class = 'qty'
       size = 16 } ?></td>
</tr>
<tr><th><?lsmb text('Currency') ?></th>
    <td><?lsmb
       INCLUDE select element_data = {
                id = 'curr'
              name = 'curr'
           options = currencies
    default_values = [curr]
  "data-dojo-type" = "lsmb/PublishSelect"
 "data-dojo-props" = "topic:'/timecard/curr'"
       }; ?>
<tr><th><?lsmb text('Unit price') ?></th>
    <td><?lsmb PROCESS input element_data = {
         id = 'unitprice'
       name = 'unitprice'
      value = unitprice
       type = 'text'
      class = 'qty'
  "data-dojo-type" = "lsmb/PublishNumberTextBox"
 "data-dojo-props" = "topic:'/timecard/unitprice'"
       size = 16 } ?></td>
</td>
<tr><th><?lsmb text('FX rate') ?></th>
    <td><?lsmb PROCESS input element_data = {
       name = 'fxrate'
      value = fxrate
       type = 'text'
      class = 'qty'
       size = 16 } ?></td>
</td>
<tr><th><?lsmb text('Sell Price') ?></th>
    <td id=sellprice><?lsmb sellprice ?></td>
</tr>
<tr><th><?lsmb text('FX Sell Price') ?></th>
    <td id=fxsellprice><?lsmb fxsellprice ?></td>
</tr>
<tr><th><?lsmb text('Allocated') ?></th>
    <td><?lsmb allocated ?></td>
</tr>
<tr><th align><?lsmb text('Notes') ?></th>
    <td colspan=3>
        <?lsmb PROCESS textarea element_data = {
                     name = "notes"
                     rows = 2
                     cols = 46
                     wrap = "soft"
                     text = notes } ?>
    </td>
</tr>
</tbody></table>
<?lsmb IF id; 
    PROCESS print_options; 
END; ?>
<?lsmb 
IF id && !in_edit;
    PROCESS button element_data = {
       name = 'action'
       type = 'submit'
      class = 'submit'
       text = text('New')
       value = 'new'
    };
    PROCESS button element_data = {
       name = 'action'
       type = 'submit'
      class = 'submit'
       text = text('Edit')
       value = 'edit'
    };
ELSE;
   PROCESS button element_data = {
         id = 'action_save'
       name = 'action'
       type = 'submit'
      class = 'submit'
       text = text('Save')
      value = 'save'
   disabled =  jctype < 1 OR jctype > 3
   }; ?>
<div style="display:none">
<?lsmb
    PROCESS button element_data = {
         id = 'action_refresh'
       name = 'action'
       type = 'refresh'
      class = 'submit'
       text = text('Refresh')
       value = 'refresh'
    };
?>
</div>
<?lsmb
END;
IF id;
    PROCESS button element_data = {
       name = 'action'
      class = 'submit'
       text = text('Print')
       value = 'print'
       "data-dojo-type" = "lsmb/PrintButton"
   };
END;
IF id && (!allocated || qty > allocated);
    PROCESS button element_data = {
       name = 'action'
       type = 'submit'
      class = 'submit'
       text = text('Delete')
       value = 'delete'
       type = 'submit'
    };
END;
?>
</form>
</body>
</html>
