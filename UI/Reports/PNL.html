<?lsmb INCLUDE 'ui-header.html' include_stylesheet = ['UI/Reports/pnl.css'];
account_data = report.account_data;
FORMATS = LIST_FORMATS();

PROTO='http';

IF (ENVARS.SERVER_PORT == '443') or 
   (ENVARS.HTTPS and ENVARS.HTTPS != 'OFF'); 
   PROTO='https'; 
END;

SERVER = ENVARS.SERVER_NAME;

IF (ENVARS.SERVER_PORT != '80') and ENVARS.SERVER_PORT
                                and (ENVARS.SERVER_PORT != '443');
   SERVER = SERVER _ ':' _ ENVARS.SERVER_PORT;
END;

QSTR=ENVARS.QUERY_STRING;

LINK = PROTO _ '://' _ SERVER _ ENVARS.SCRIPT_NAME 
           _ '?' _ QSTR _ '&amp;' _ 'company=' _ DBNAME;

LINK = LINK.replace('\&amp;\&amp;', '&amp;');
?>
<?lsmb COLS = comparison.length + 2 ?>
<body class="financial-statement <?lsmb dojo_theme ?>">
<div id="PNL"> <!-- Also used in balance sheet! -->
<h1><?lsmb name ?></h1>
<h2><?lsmb text('Accounting period: [_1] to [_2]', report.from_date, report.to_date); ?></h2>
<?lsmb 
comparisons = report.comparisons;
IF comparisons;
    FOREACH COMP IN comparisons ?>
<h2><?lsmb text('Compared to: [_1] to [_2]', COMP.from_date, COMP.to_date) ?>
</h2>
   <?lsmb END;
END ?>
<table class="income_statement">
<tbody>
    <tr class="sectionhead">
        <th colspan="<?lsmb account_data.${rows.0.accno}.max_depth ?>"></th>
        <th><?lsmb IF report.from_date || report.to_date; 
                        report.from_date _ '<br /> - <br />' 
                        _ report.to_date; 
                   ELSE; '&nbsp;'; END ?>
        </th>
    <?lsmb FOREACH COMP IN comparisons ?>
        <th><?lsmb IF COMP.from_date || COMP.to_date; 
                            COMP.from_date _ '<br /> - <br />' _ COMP.to_date;
                   ELSE; '&nbsp;'; END ?></th>
    <?lsmb END ?>
    </tr>
  <?lsmb CALL rows.pop ;
         FOREACH k IN rows ?>
    <tr class="incomerow">
      <?lsmb IF account_data.${k.accno}.depth > 0 ?>
        <td colspan="<?lsmb account_data.${k.accno}.depth ?>"></td>
	<?lsmb END ?>
	<td class="label"
	<?lsmb IF (account_data.${k.accno}.depth < account_data.${k.accno}.max_depth) ?>
	      colspan="<?lsmb (account_data.${k.accno}.max_depth - account_data.${k.accno}.depth) ?>"
	       <?lsmb END ?>
><a href="journal.pl?sort=transdate&amp;accno=<?lsmb k.accno
                                    ?>&amp;from_date=<?lsmb report.from_date 
                                    ?>&amp;to_date=<?lsmb report.to_date 
                                    ?>&amp;category=X&amp;col_transdate=Y&amp;col_reference=Y&amp;col_description=Y&amp;col_debits=Y&amp;col_credits=Y&amp;col_source=Y&amp;col_accno=Y&amp;action=search"
        >
             <?lsmb k.accno ?>&nbsp;-&nbsp;<?lsmb k.description ?></td>
        <td class="amount"><a href="journal.pl?sort=transdate&amp;accno=<?lsmb k.accno
                                    ?>&amp;from_date=<?lsmb report.from_date 
                                    ?>&amp;to_date=<?lsmb report.to_date 
                                    ?>&amp;category=X&amp;col_transdate=Y&amp;col_reference=Y&amp;col_description=Y&amp;col_debits=Y&amp;col_credits=Y&amp;col_source=Y&amp;col_accno=Y&amp;action=search"
        ><?lsmb account_data.${k.accno}.main.amount ?></a></td>
	
       
    <?lsmb FOREACH COMP IN comparisons ?>
        <td class="amount"><a href="journal.pl?sort=transdate&amp;accno=<?lsmb k 
                                   ?>&amp;from_date=<?lsmb COMP.from_date 
                                   ?>&amp;to_date=<?lsmb COMP.to_date
                                   ?>&amp;category=X&amp;col_transdate=Y&amp;col_reference=Y&amp;col_description=Y&amp;col_debits=Y&amp;col_credits=Y&amp;col_source=Y&amp;col_accno=Y&amp;action=search"
           ><?lsmb COMP.account_data.${k.accno}.info.amount ?></a></td>
    <?lsmb END ?>
    </tr>
   <?lsmb END ?>
   <tr class="reportfoot">
     <th colspan="<?lsmb account_data.${rows.0.accno}.max_depth ?>"> = <?lsmb text('Net Income (Loss)') ?></th>
     <td class="amount total"><?lsmb account_data.totals.main.total ?></td>
    <?lsmb FOREACH COMP IN comparisons ?>
        <td class="amount total">
            <?lsmb COMP.account_data.totals.main.total ?></td>
    <?lsmb END ?>
   </tr>
<?lsmb IF FORMATS.grep('PDF').size() ?>
<tr><td><a href="<?lsmb LINK ?>&amp;format=PDF">[<?lsmb text('PDF') ?>]</a></td>
<td><a href="<?lsmb LINK ?>&amp;format=CSV">[<?lsmb text('CSV') ?>]</a></td>
<?lsmb END ?>
</tbody>
</table>
</div>
</body>
</html>

