<div id="credit_div" class="container">
<div class="listtop"><strong>Accounts</strong></div>
<?lsmb 

FOREACH cl IN credit_list;
   IF entity_class == 1;
        account_class_label = text('Vendor');
   ELSIF  entity_class == 2;
        account_class_label = text('Customer');
   END;
   cl.meta_number_href_suffix = 'account_class=' _ cl.entity_class _ 
      '&entity_id=' _ cl.entity_id _ '&meta_number=' _ cl.meta_number _
      '&target_div=credit_div';
END;

PROCESS dynatable 
      attributes = {id = 'credit_accounts_list' }
      columns = [ 
        { col_id = 'account_class_label', type = 'text', name = text('Type') }
        { col_id = 'meta_number', type = 'href', name = text("Number"), 
          href_base = "$script?action=get&" }
        { col_id = 'description', type = 'text', name = text("Description") }
        { col_id = 'credit_limit', type = 'text', name = text('Credit Limit') }
        { col_id = 'start_date', type = 'text', name = text('Start Date') }
        { col_id = 'end_date', type = 'text', name = text('End Date') }
    ], #'
    tbody = {rows = credit_list}; ?>
    <form id="credit_form" name="credit_form" method="post" 
	action="<?lsmb script ?>">
<?lsmb PROCESS input element_data = {
		type = "hidden"
		name = "form_id"
		value = form_id
	} ?>
	<?lsmb PROCESS input element_data = {
		type = "hidden"
		name = "entity_id"
		value = entity_id
	} ?>	
	<?lsmb PROCESS input element_data = {
		type = "hidden"
		name = "id"
		value = credit_act.id
	} ?>	
	<?lsmb ec = credit_act.entity_class;
              IF !ec;
                 ec=account_class;
                 IF !ec;
                    ec=entity_class;
                 END;
              END;
              PROCESS input element_data = {
		type = "hidden"
		name = "entity_class"
		value = ec
	} ?>	
        <table>
	<tr class="eca_row">
	<td>
 	<?lsmb PROCESS input element_data = {
		label = text("$entity_classname Number"), #fixme for i18n
		type= "text",
		name = "meta_number",
		value = credit_act.meta_number,
		size = "10"
	}  # " ?></td>
	<td><?lsmb PROCESS input element_data = {
		label = text("Description"),
		type= "text",
		name = "description",
		value = credit_act.description,
		size = "20"
	} ?></td>
	</tr>
	<tr class="pay_to_row">
	<td colspan = "2">
	<?lsmb PROCESS input element_data = {
		label = text('Pay To') #'
		type = "text"
		size = "50"
		name = "pay_to_name"
		value = credit_act.pay_to_name
		class = "name"
	} ?>
	</td>
        </tr>
        <tr id="date-row">
            <td>
		<?lsmb PROCESS input element_data = {
			label = text('Starting Date'),
			name = "startdate",
			class = "date",
			value = credit_act.startdate,
			type = "text",
			size = "12",
			maxlength = "10"
		} #' ?>
            </td>
            <td>
		<?lsmb PROCESS input element_data = {
			label = text('End Date'),
			name = "enddate",
			class = "date",
			value = credit.enddate,
			type = "text",
			size = "12",
			maxlength = "10"
		} #' ?>
            </td>
        </tr>
        <tr id="credit-row">
            <td>
		<?lsmb INCLUDE input element_data = {
			label = text('Credit Limit'),
			name = "creditlimit",
			value = credit_act.creditlimit,
			type = "text",
			size = "20"
		} #' ?>
            </td>
            <td><span id="terms-span">
		<?lsmb INCLUDE input element_data = {
			label = text('Terms'),
			name = "terms",
			value = credit_act.terms,
			type = "text",
			size = "5"
		} ?> <?lsmb text('days') ?></span>
            </td>
	</tr>
	<tr id="discount-gifi-row">
            <td>
		<?lsmb INCLUDE input element_data = {
			label = text('Discount'),
			name = "discount",
			value = credit_act.discount,
			type = "text",
			size = "3",
			maxlength = 3
		} ?>% / 
		<?lsmb INCLUDE input element_data = {
			name = "discount_terms",
			value = credit_act.discount_terms,
			type = "text",
			size = "3",
			maxlength = 3
		} ?> <?lsmb text('days') ?>
            </td>
            <td>
		<?lsmb INCLUDE input element_data = {
			label = text('Subcontract GIFI'),
			name = "gifi_accno",
			value = credit_act.gifi_accno,
			type = "text",
			size = "19"
		} #' ?>
            </td>
        </tr>
        <tr id="account-link-row">
           <td> <?lsmb INCLUDE select element_data = {
			name = "ar_ap_account_id"
			default_values = [credit_act.ar_ap_account_id]
			options = ar_ap_acc_list
			label = text((account_class == 1) ? 'AP' : 'AR')
			text_attr = "text"
			value_attr = "id"
                } ?>
           </td>
           <td> <?lsmb INCLUDE select element_data = {
			name = "cash_account_id"
			default_values = [credit_act.cash_account_id]
			options = cash_acc_list
			label = text('Payment')
			text_attr = "text"
			value_attr = "id"
                } ?>
           </td>
           <td> <?lsmb INCLUDE select element_data = {
                        name = "discount_account_id"
                        default_values = [credit_act.discount_account_id]
                        options = discount_acc_list
                        label = text('Discount')
                        text_attr = "text"
                        value_attr = "id"
                } ?>
           </td>
        </tr>
        <tr id="business-threshold-row">
           <td> <?lsmb business_types.unshift({});
                       INCLUDE select element_data = {
			name = "business_id"
			options = business_types
			default_values = [credit_act.business_id]
			text_attr = "description"
			value_attr = "id"
			label = text('Business Type') #'
			} ?> 
	  </td>
          <td> <?lsmb INCLUDE input element_data = {
			name = "threshold"
			value = credit_act.threshold
			type = "text"
			size = "20"
			label = text('Threshold')
			class = "numeric"
               } ?>
	</tr>

	<tr id="taxform-threshold-row">
        <?lsmb taxform_list.unshift({}) ?>
	
	 <td> <?lsmb INCLUDE select element_data = {
			name = "taxform_id"
			options = taxform_list
			default_values = [credit_act.taxform_id]
			text_attr = "form_name"
			value_attr = "id"
			label = text('Taxforms') 
			} ?> 
	  </td>
        <td> <?lsmb INCLUDE select element_data = {
		label = text("Language")
		name = "language_code"
                default_values = [credit_act.language_code],
                options = language_code_list
		text_attr = "text"
		value_attr = "code"
                } ?>
        </td>
          <td> <?lsmb INCLUDE select element_data = {
                        name = 'curr'
                        options = all_currencies
                        text_attr = 'text'
                        value_attr = 'text'
                        default_values = [credit_act.curr]
                        label = text('Currency')
               } ?>
           </td>

        </tr>

        </table>
        <div class="input_container" id="tax-credit-div">
        <div class="listtop"><?lsmb text('Taxes') ?></div>
        <?lsmb FOR tx = all_taxes ?> 
        <div class="inputrow" id="taxrow-<?lsmb tx.chart_id ?>">
        <span class="lable" id="txlabel-<?lsmb tx.chart_id ?>">
            <?lsmb tx.accno ?>--<?lsmb tx.description ?></span>
        <span class="input" id="txinput-<?lsmb tx.id ?>">
            <?lsmb checked = "";  
                   IF credit_act.tax_ids.grep(tx.id).size == 1;
                       checked = "CHECKED";
                   END;
                   INCLUDE input element_data = {
                           type = "checkbox"
                           checked = checked
                           name = "taxact_$tx.id"
                           value = tx.id
                   } ?><span></div>
        <?lsmb END # FOR tx ?>
         </div>
		<?lsmb IF credit_act.id;
		INCLUDE button element_data = {
			text = text('Save Changes'), #'
			class="submit" 
			type="submit" 
			name="action" 
			value="save_credit" 
			accesskey="C" 
			title="Save Credit Account[Alt-C]"
		};
		END;
		INCLUDE button element_data = {
			text = text('Save New'), #'
			class="submit" 
			type="submit" 
			name="action" 
			value="save_credit_new"  
			title="Save Credit Account as New" 
		};
                IF credit_act.id;
		    INCLUDE button element_data = {
                        class="submit" 
                        type="submit" 
                        name="action" 
                        value="add_transaction" 
                        accesskey="A" 
                        title="Transaction [Alt-A]"
			text = (entity_class == 1) ? text('AP Transaction') : text('AR Transaction')
		    }; 
		    INCLUDE button element_data = {
                        class="submit" 
                        type="submit" 
                        name="action" 
                        value="add_invoice" 
                        accesskey="I" 
                        title="Invoice [Alt-I]"
			text = (entity_class == 1) ? text('Vendor Invoice')  : text('Customer Invoice') 
		    };
		    INCLUDE button element_data = {
                        class="submit" 
                        type="submit" 
                        name="action" 
                        value="add_order" 
                        accesskey="O" 
                        title="Order [Alt-O]"
			text = (entity_class == 1) ? text('Purchase Order') : text('Sales Order')
		    };
		    INCLUDE button element_data = {
                        class="submit" 
                        type="submit" 
                        name="action" 
                        value="rfq" 
                        accesskey="Q" 
                        title="Quotation [Alt-Q]"
			text = (entity_class == 1) ? text('RFQ') : text('Quotation')
		    };
		    INCLUDE button element_data = {
                        class="submit" 
                        type="submit" 
                        name="action" 
                        value="pricelist" 
                        accesskey="P" 
                        title="Pricelist [Alt-P]"
			text = text('Pricelist') 
		    };
                END ?>
	
    </form>
</div>
</div>
