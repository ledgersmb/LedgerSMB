<?lsmb INCLUDE "ui-header.html"
stylesheet="ledgersmb.css"
include_stylesheet=["setup/stylesheet.css"] ?>
<?lsmb PROCESS elements.html ?>
<body id="setup-upgrade-info" class="lsmb <?lsmb dojo_theme ?>">
<div class="setupconsole">
<h2><?lsmb text('Database Management Console') ?></h2>
<div class="listtop"><?lsmb text('Upgrade Info') ?></div>
<form data-dojo-type="lsmb/SimpleForm"
      action="setup.pl" method="POST"
      name="upgrade_info">
            <?lsmb upgrade_allowed = 1 ?>
<?lsmb INCLUDE input element_data = {
    name = 'database'
    type = 'hidden'
   value = database
} ?>
<div class="form">
<p>
  LedgerSMB has introduced three new system wide default values which
  you will need to set as part of the upgrade process.
</p>
<p>
  In addition to these new defaults LedgerSMB adds stricter
  checks on data validity in the database. Because of these
  stricter checks it's no longer valid to leave companies
  without a country or customers without accounts receivable
  reference. The defaults you choose below will be used to add
  values where these are currently missing but required.
</p>
<div class="input_row">
<?lsmb INCLUDE select element_data = {
                          options = countries
                       value_attr = 'code'
                        text_attr = 'country'
                            name  = 'default_country'
                           label  = text('Default Country') #'
                            class = 'country'
} ?>
</div>
<div class="input_row">
<p>
  LedgerSMB supports multiple <em>Accounts receivable (AR)
  </em> accounts per company.
  <?lsmb IF ar_accounts.size > 1 ?>
    <span>One of those must be the system default.
   Please select your default below.</span>
  <?lsmb ELSE; ?>
    <span>Your AR account has been selected to be the
    system default. Please review.</span>
  <?lsmb END ?>
  <?lsmb AR_DISABLED = "";
    IF ar_accounts.size <= 1 && !ar_accounts.0.id; ?>
    <span style='font-weight:bold'>
          No <em>AR</em> account available, your database is
          in an inconsistent state and needs to be fixed first.
    </span>
  <?lsmb AR_DISABLED = "disabled";
         upgrade_allowed = 0;
  END ?>
</p>
<?lsmb INCLUDE select element_data = {
                            name  = 'default_ar'
                           label  = text('Default AR') #'
                            class = 'accno'
                            options = ar_accounts
                            value_attr = 'accno'
                            text_attr = 'desc'
                            disabled = AR_DISABLED
} ?>
</div>
<div class="input_row">
<p>
LedgerSMB supports multiple <em>Accounts payable (AP)
</em> accounts per company.
<?lsmb IF ap_accounts.size > 1 ?>
<span>One of those must be the system default.
Please select your default below.</span>
<?lsmb ELSE; ?>
<span>Your AP account has been selected to be the
system default. Please review.</span>
<?lsmb END ?>
<?lsmb AP_DISABLED = "";
IF ap_accounts.size <= 1 && !ap_accounts.0.id; ?>
<span style='font-weight:bold'>
      No <em>AP</em> account available, your database is
      in an inconsistent state and needs to be fixed first.
</span>
<?lsmb AP_DISABLED = "disabled";
     upgrade_allowed = 0;
END ?>
</p>
<?lsmb INCLUDE select element_data = {
                            name  = 'default_ap'
                           label  = text('Default AP') #'
                            class = 'accno'
                            options = ap_accounts
                            value_attr = 'accno'
                            text_attr = 'desc'
                                                disabled = AP_DISABLED
} ?>
</div>
<div class="input_row">
<p>
  Note that the process invoked by hitting the button below might
  take long to complete as it will run the upgrade process and will
  copy all data from the original tables into the newer tables.
</p>
<?lsmb IF upgrade_allowed;
    INCLUDE button element_data = {
    text = text('Upgrade')
    name = 'action'
   value = upgrade_action
        type = 'submit'
       class = 'submit'
    };
END;
INCLUDE button element_data = {
    text = text('Cancel')
    name = 'action'
   value = cancel
    type = 'submit'
   class = 'submit'
} ?>
</div>
</div>
</form>
</div>
</body>
</html>
