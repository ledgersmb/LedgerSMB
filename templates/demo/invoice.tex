<?lsmb FILTER latex { format="$FORMAT(pdflatex)" } -?>
\documentclass{scrartcl}
\usepackage[utf8]{inputenc}
\usepackage{tabularx}
\usepackage{longtable}
\usepackage[letterpaper,top=2cm,bottom=1.5cm,left=1.1cm,right=1.5cm]{geometry}
\usepackage{graphicx}
\setlength\LTleft{0pt}
\setlength\LTright{0pt}
\begin{document}

\pagestyle{myheadings}
\thispagestyle{empty}

\fontfamily{cmss}\fontsize{10pt}{12pt}\selectfont

<?lsmb BLOCK multiline -?>
\begin{minipage}{2in}
\medskip
\raggedright
<?lsmb string | escape ?>
\end{minipage}
<?lsmb- END -?>

\newsavebox{\ftr}
\sbox{\ftr}{
  \parbox{\textwidth}{
  \tiny
  \rule[1.5em]{\textwidth}{0.5pt}
<?lsmb text('Payment due NET [_1] Days from date of Invoice.', terms) | escape ?>
<?lsmb text('Interest on overdue amounts will acrue at the rate of 12% per annum starting from [_1] until paid in full. Items returned are subject to a 10% restocking charge.', duedate) | escape ?>
<?lsmb text('A return authorization must be obtained from [_1] before goods are returned. Returns must be shipped prepaid and properly insured. [_1] will not be responsible for damages during transit.', company) | escape ?>
  }
}

<?lsmb INCLUDE letterhead ?>

\markboth{<?lsmb company | escape ?>\hfill <?lsmb invnumber | escape ?>}{<?lsmb company | escape ?>\hfill <?lsmb invnumber | escape ?>}

\vspace*{0.5cm}

\parbox[t]{.5\textwidth}{
\textbf{To}
\vspace{0.3cm}

<?lsmb name | escape ?>

<?lsmb address1 | escape ?>

<?lsmb address2 | escape ?>

<?lsmb city | escape ?>
<?lsmb IF state -?>
\hspace{-0.1cm}, <?lsmb state | escape ?> <?lsmb END ?> <?lsmb zipcode | escape ?>

<?lsmb country | escape ?>

\vspace{0.3cm}

<?lsmb IF contact ?>
<?lsmb contact | escape ?>
\vspace{0.2cm}
<?lsmb END ?>

<?lsmb IF customerphone ?>
Tel: <?lsmb customerphone | escape ?>
<?lsmb END ?>

<?lsmb IF customerfax ?>
Fax: <?lsmb customerfax | escape ?>
<?lsmb END ?>

<?lsmb email | escape ?>
}
\parbox[t]{.5\textwidth}{
\textbf{<?lsmb text('Ship To') | escape ?>}
\vspace{0.3cm}

<?lsmb shiptoname | escape ?>

<?lsmb shiptoaddress1 | escape ?>

<?lsmb shiptoaddress2 | escape ?>

<?lsmb shiptocity | escape ?>
<?lsmb IF shiptostate -?>
\hspace{-0.1cm}, <?lsmb shiptostate | escape ?><?lsmb END ?> <?lsmb shiptozipcode | escape ?>

<?lsmb shiptocountry | escape ?>

\vspace{0.3cm}

<?lsmb IF shiptocontact ?>
<?lsmb shiptocontact | escape ?>
\vspace{0.2cm}
<?lsmb END ?>

<?lsmb IF shiptophone ?>
Tel: <?lsmb shiptophone | escape ?>
<?lsmb END ?>

<?lsmb IF shiptofax ?>
Fax: <?lsmb shiptofax | escape ?>
<?lsmb END ?>

<?lsmb shiptoemail | escape ?>
}
\hfill

\vspace{1cm}

\textbf{\MakeUppercase{<?lsmb
    IF reverse;
       text('Credit Invoice');
    ELSE;
       text('Invoice');
    END; | escape ?>}}
\hfill

\vspace{1cm}

\begin{tabularx}{\textwidth}{*{7}{|X}|} \hline
  \textbf{<?lsmb text('Invoice #') | escape ?>} & \textbf{<?lsmb text('Date') | escape ?>} 
      & \textbf{<?lsmb text('Due') | escape ?>} & \textbf{<?lsmb text('Order #') | escape ?>}
      & \textbf{<?lsmb text('Salesperson') | escape ?>} 
      & \textbf{<?lsmb text('Shipping Point') | escape ?>} 
      & \textbf{<?lsmb text('Ship via') | escape ?>} \\ [0.5em]
  \hline
  <?lsmb invnumber | escape ?> & <?lsmb invdate | escape ?> & <?lsmb duedate | escape ?> & <?lsmb ordnumber | escape ?> & <?lsmb employee | escape ?>
  & <?lsmb shippingpoint | escape ?> & <?lsmb shipvia | escape ?> \\
  \hline
\end{tabularx}

\vspace{1cm}

\begin{longtable}{@{\extracolsep{\fill}}r|llcrlrr|r}

  \textbf{<?lsmb text('Item') | escape ?>} 
  & \textbf{<?lsmb text('Number') | escape ?>}
  & \textbf{<?lsmb text('Description') | escape ?>} 
  & \textbf{<?lsmb text('Delivery') | escape ?>} 
  & \textbf{<?lsmb text('Qty') | escape ?>} 
  & \textbf{<?lsmb text('Unit') | escape ?>} 
  & \textbf{<?lsmb text('Price') | escape ?>} 
  &  \textbf{<?lsmb text('Disc %') | escape ?>} 
  & \textbf{<?lsmb text('Amount') | escape ?>} \\
\hline
\endhead
<?lsmb FOREACH number ?>
<?lsmb lc = loop.count - 1 ?>
  <?lsmb runningnumber.${lc} | escape ?> & 
  <?lsmb number.${lc} | escape ?> & 
  <?lsmb INCLUDE multiline string = item_description.${lc} ?> & 
  <?lsmb deliverydate.${lc} | escape ?> &
  <?lsmb qty.${lc} | escape ?> & 
  <?lsmb unit.${lc} | escape ?> &
  <?lsmb sellprice.${lc} | escape ?> &
  <?lsmb discountrate.${lc} | escape ?> &
  <?lsmb linetotal.${lc} | escape ?> \\
<?lsmb END ?>
 \hline \hline
<?lsmb IF tax ?>
\multicolumn{8}{r|}{<?lsmb text('Subtotal') | escape ?>} & <?lsmb subtotal | escape ?> \\*
<?lsmb FOREACH tax ?>
<?lsmb lc = loop.count - 1 ?>
\multicolumn{8}{r|}{<?lsmb taxdescription.${lc} 
                    | escape ?>  on <?lsmb taxbase.${lc} | escape ?> }
 & <?lsmb tax.${lc} | escape ?> \\*
<?lsmb END ?>
<?lsmb END ?>
\hline \hline
\multicolumn{8}{r|}{<?lsmb text('Total') | escape ?>} & <?lsmb invtotal | escape ?> \\*

<?lsmb IF paymentdate.0 ?>
\multicolumn{8}{r|}{ <?lsmb text('Paid') | escape ?> } & - <?lsmb paid | escape ?> \\*
  \hline
  \hline
\multicolumn{8}{r|}{<?lsmb text('Balance') | escape ?>} & <?lsmb total | escape ?>\\
<?lsmb END ?>

\end{longtable}


\parbox{\textwidth}{

\vspace{0.2cm}

\hfill

\vspace{0.3cm}

<?lsmb text_amount | escape ?> ***** <?lsmb decimal | escape ?>/100
\hfill
<?lsmb text('All prices in [_1].', currency) | escape ?>

\vspace{12pt}
<?lsmb FOREACH P IN notes.split('\n{2,}') ?>
<?lsmb P | escape ?>\medskip

<?lsmb END ?>
}

\vfill

<?lsmb IF paymentdate.0 ?>
\begin{tabularx}{10cm}{@{}lXlr@{}}
  \textbf{<?lsmb text('Payments') | escape ?>} & & & \\
  \hline
  \textbf{<?lsmb text('Date') | escape ?>} & & \textbf{<?lsmb text('Source') | escape ?>} 
  & \textbf{<?lsmb text('Amount') | escape ?>} \\
<?lsmb END ?>
<?lsmb FOREACH payment ?>
<?lsmb lc = loop.count - 1 ?>
  <?lsmb paymentdate.${lc} | escape ?> & <?lsmb paymentaccount.${lc} | escape ?> & <?lsmb paymentsource.${lc} | escape ?> & <?lsmb payment.${lc} | escape ?> \\
<?lsmb END ?>
<?lsmb IF paid_1 ?>
\end{tabularx}
<?lsmb END ?>

\vspace{1cm}

\centerline{\textbf{<?lsmb text('Thank You for your valued business!') | escape ?>}}

\rule{\textwidth}{0.5pt}

\usebox{\ftr}

\end{document}
<?lsmb END ?>
