<?lsmb FILTER latex { format="$FORMAT(pdflatex)" } -?>
\documentclass{scrartcl}
\usepackage[utf8]{inputenc}
\usepackage{tabularx}
\usepackage[top=2cm,bottom=1.5cm,left=2cm,right=1cm]{geometry}
\usepackage{graphicx}
\setlength{\parindent}{0pt}

\begin{document}

\pagestyle{empty}

\fontfamily{cmss}\fontsize{10pt}{12pt}\selectfont

\parbox{\textwidth}{%
  \parbox[b]{.42\textwidth}{%
    <?lsmb company | escape ?>
   
    <?lsmb address | escape ?>
  }
  %\parbox[b]{.2\textwidth}{
    %\includegraphics[scale=0.3]{ledger-smb}
  %}
  \hfill
  \begin{tabular}[b]{rr@{}}
  <?lsmb text('Tel:') | escape ?> & <?lsmb tel | escape ?>\\
  <?lsmb text('Fax:') | escape ?> & <?lsmb fax | escape ?>
  \end{tabular}

  \rule[1.5em]{\textwidth}{0.5pt}
}

\centerline{\MakeUppercase{<?lsmb text('AR Transaction') | escape ?>}}

\vspace*{0.5cm}

\parbox[t]{.5\textwidth}{
<?lsmb name | escape ?>

<?lsmb address1 | escape ?>

<?lsmb address2 | escape ?>

<?lsmb city | escape ?>
<?lsmb IF state ?>
, <?lsmb state | escape ?>
<?lsmb END ?>
<?lsmb zipcode | escape ?>

<?lsmb country | escape ?>

\vspace{0.3cm}

<?lsmb IF contact ?>
<?lsmb contact | escape ?>
<?lsmb END ?>

\vspace{0.2cm}

<?lsmb IF customerphone ?>
<?lsmb text('Tel: [_1]', customerphone) | escape ?>
<?lsmb END ?>

<?lsmb IF customerfax ?>
<?lsmb text('Fax: [_1]', customerfax) | escape ?>
<?lsmb END ?>

<?lsmb email | escape ?>

<?lsmb IF customertaxnumber ?>
<?lsmb text('Tax Number: [_1]', customertaxnumber) | escape ?>
<?lsmb END ?>
}
\hfill
\begin{tabular}[t]{ll}
  \textbf{<?lsmb text('Invoice #') | escape ?>} & <?lsmb invnumber | escape ?> \\
  \textbf{<?lsmb text('Date') | escape ?>} & <?lsmb invdate | escape ?> \\
  \textbf{<?lsmb text('Due') | escape ?>} & <?lsmb duedate | escape ?> \\
  <?lsmb IF ponumber ?>
    \textbf{PO \#} & <?lsmb ponumber | escape ?> \\
  <?lsmb END ?>
  <?lsmb IF ordnumber ?>
    \textbf{<?lsmb text('Order #') | escape ?>} & <?lsmb ordnumber | escape ?> \\
  <?lsmb END ?>
  \textbf{<?lsmb text('Employee') | escape ?>} & <?lsmb employee | escape ?> \\
\end{tabular}

\vspace{1cm}

\begin{tabularx}{\textwidth}[t]{@{}llrX@{\hspace{1cm}}l@{}}
<?lsmb FOREACH amount ?>
<?lsmb lc = loop.count - 1 ?>
  <?lsmb accno.${lc} | escape ?> &
  <?lsmb account.${lc} | escape ?> &
  <?lsmb amount.${lc} | escape ?> &
  <?lsmb description.${lc} | escape ?> &
  <?lsmb projectnumber.${lc} | escape ?> \\
<?lsmb END ?>

  \multicolumn{2}{r}{\textbf{Subtotal}} & <?lsmb subtotal | escape ?> & \\
<?lsmb FOREACH tax ?>
<?lsmb lc = loop.count - 1 ?>
  \multicolumn{2}{r}{\textbf{<?lsmb taxdescription.${lc} | escape ?> @ <?lsmb taxrate.${lc} | escape ?> \%}} & <?lsmb tax.${lc} | escape ?> & \\
<?lsmb END ?>

  \multicolumn{2}{r}{\textbf{Total}} & <?lsmb invtotal | escape ?> & \\
  
\end{tabularx}

\vspace{0.3cm}

<?lsmb text_amount | escape ?> ***** <?lsmb decimal | escape ?>/100 <?lsmb currency | escape ?>

<?lsmb IF notes ?>
\vspace{0.3cm}
<?lsmb FOREACH P IN notes.split('\n{2,}') ?>
<?lsmb P | escape ?>\medskip

<?lsmb END ?>
<?lsmb END ?>

\vspace{0.3cm}

<?lsmb IF paid_1 ?>
\begin{tabular}{@{}lllr@{}}
  \multicolumn{5}{c}{\textbf{<?lsmb text('Payments') | escape ?>}} \\
  \hline
  \textbf{<?lsmb text('Date') | escape ?>} & & \textbf{<?lsmb text('Source') | escape ?>} & 
        \textbf{<?lsmb text('Amount') | escape ?>} \\
<?lsmb END ?>
<?lsmb FOREACH payment ?>
<?lsmb lc = loop.count - 1 ?>
  <?lsmb paymentdate.${lc} | escape ?> & <?lsmb paymentaccount.${lc} | escape ?> & <?lsmb paymentsource.${lc} | escape ?> & <?lsmb payment.${lc} | escape ?> \\
<?lsmb END ?>
<?lsmb IF paid_1 ?>
\end{tabular}
<?lsmb END ?>

\vspace{0.5cm}

<?lsmb FOREACH tax ?>
<?lsmb lc = loop.count - 1 ?>
\textbf{\scriptsize <?lsmb taxdescription.${lc} | escape ?> <?lsmb text('Registration') | escape ?> <?lsmb taxnumber.${lc} | escape ?>} \\
<?lsmb END ?>
  
\end{document}
<?lsmb END ?>
